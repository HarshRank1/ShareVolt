@* @model ShareVolt.ViewModels.BookingDetailsViewModel
@using System.Security.Claims

@{
    ViewData["Title"] = "Details";
}

@{
    var isAdminClaim = User.FindFirstValue("IsAdmin");
    bool isAdmin = false;
    if (!string.IsNullOrEmpty(isAdminClaim))
    {
        isAdmin = (isAdminClaim == "True");
    }

    var emailClaim = User.FindFirstValue(ClaimTypes.Email);
    string currentUserEmail = emailClaim ?? string.Empty;






    var userIdClaim = User.FindFirstValue(ClaimTypes.NameIdentifier);
    int currentUserId = 0;
    if (!string.IsNullOrEmpty(userIdClaim))
    {
        currentUserId = int.Parse(userIdClaim);
    }
}

<h1>Details</h1>

<div>
    <h4>BookingDetailsViewModel</h4>
    <hr />
    <dl class="row">
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.StartTime)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.StartTime)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.EndTime)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.EndTime)
        </dd>

        @if(currentUserEmail == Model.UserEmail)
        {
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.TotalAmount)
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.TotalAmount)
            </dd>

        }

        

        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.SizeType)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.SizeType)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.BatterySize)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.BatterySize)kwh
        </dd>
        <dt class = "col-sm-2">
            Battery %
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.ExpectedBatteryPercentage)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Status)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Status)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.UserEmail)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.UserEmail)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.HostEmail)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.HostEmail)
        </dd>
    </dl>
</div>
<div>
    <a asp-action="UsersBookingIndex" asp-route-id="@currentUserId" >Back to List</a>
</div> *@


@model ShareVolt.ViewModels.BookingDetailsViewModel
@using System.Security.Claims

@{
    ViewData["Title"] = "Booking Details";

    var isAdminClaim = User.FindFirstValue("IsAdmin");
    bool isAdmin = !string.IsNullOrEmpty(isAdminClaim) && isAdminClaim == "True";

    var emailClaim = User.FindFirstValue(ClaimTypes.Email);
    string currentUserEmail = emailClaim ?? string.Empty;

    var userIdClaim = User.FindFirstValue(ClaimTypes.NameIdentifier);
    int currentUserId = !string.IsNullOrEmpty(userIdClaim) ? int.Parse(userIdClaim) : 0;
}

<div class="container mt-5">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">Booking Details</h3>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>Start Time:</strong>
                    <p>@Html.DisplayFor(m => m.StartTime)</p>
                </div>
                <div class="col-md-6">
                    <strong>End Time:</strong>
                    <p>@Html.DisplayFor(m => m.EndTime)</p>
                </div>
            </div>

            @if (currentUserEmail == Model.UserEmail)
            {
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Total Amount:</strong>
                        <p>@Html.DisplayFor(m => m.TotalAmount) ₹</p>
                    </div>
                </div>
            }

            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>Size Type:</strong>
                    <p>@Html.DisplayFor(m => m.SizeType)</p>
                </div>
                <div class="col-md-6">
                    <strong>Battery Size:</strong>
                    <p>@Html.DisplayFor(m => m.BatterySize) kWh</p>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>Battery %:</strong>
                    <p>@Html.DisplayFor(m => m.ExpectedBatteryPercentage) %</p>
                </div>
                <div class="col-md-6">
                    <strong>Status:</strong>
                    <p>
                        <span class="badge @(Model.Status == "Completed" ? "bg-success" : Model.Status == "Pending" ? "bg-warning text-dark" : "bg-secondary")">
                            @Html.DisplayFor(m => m.Status)
                        </span>
                    </p>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>User Email:</strong>
                    <p>@Html.DisplayFor(m => m.UserEmail)</p>
                </div>
                <div class="col-md-6">
                    <strong>Host Email:</strong>
                    <p>@Html.DisplayFor(m => m.HostEmail)</p>
                </div>
            </div>
        </div>

        <div class="card-footer text-end">
            <a class="btn btn-secondary" asp-action="UsersBookingIndex" asp-route-id="@currentUserId">
                <i class="bi bi-arrow-left-circle"></i> Back to List
            </a>
        </div>
    </div>
</div>

<!-- Include Bootstrap Icons for optional icon support -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
